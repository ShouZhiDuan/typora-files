"use strict";!function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e).getFullYear(),n=new Date(e).getMonth()+1,o=new Date(e).getDate();return""+t+(n<10?"0"+n:n)+(o<10?"0"+o:o)}function t(e,t,n){var o=new Date;if(-1==n)return void(document.cookie=e+"="+escape(t)+";domain=.csdn.net;path=/");if(n)o.setTime(o.getTime()+n);else{o.setTime(o.getTime()+2592e6)}document.cookie=e+"="+t+";expires="+o.toGMTString()+";domain=.csdn.net;path=/"}function n(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e&&"UD"==e)return decodeURIComponent(o[1]);if(o[0]==e)return decodeURI(o[1])}}function o(e){if(!e)return!1;var t=(new Date).getTime(),n=new Date(e.startTime.replace(/-/g,"/"));return t<=new Date(e.endTime.replace(/-/g,"/"))&&t>=n}function i(e){return!!e&&(new Date).getTime()>new Date(e.endTime.replace(/-/g,"/"))}function a(){return!!n("UserName")}function d(){return!n("redpack_close")}function r(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"],n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}function s(e){window.csdn&&window.csdn.report&&window.csdn.report.reportClick(e)}function c(e){window.csdn&&window.csdn.report&&window.csdn.report.reportView(e)}function l(){window.csdn&&window.csdn.report&&window.csdn.report.viewCheck()}function p(){this.el=null,this.timer=null,this.rains=[],this.density=300,this.maxCount=1,this.maxTime=10,this.timeLineTimer=null,this.currentRedPackId=null,this.timeBoxtimer=null,this.host="https://mp-luckydraw1.csdn.net",this.localRedPackIdTime=18e5,this.dev=!1,this.getRedPackInfo(),this.redPackAdvertObj={imgUrl:"https://g.csdnimg.cn/common/redpack/images/redpaceAdvert.png",backgroundColor:"#FFCEA6",AdvertClickSpm:"3001.6103",CloseClickSpm:"3001.6071",viewSpm:"3001.6070"}}void 0;var m=(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),[]);p.prototype.initRedPack=function(e){return this.destory(),this.currentRedPackId=e.id,void 0,this.render(),a()&&t("redpack",e.id,this.localRedPackIdTime),d()?m.indexOf(e.id)>=0?(void 0,void this.destory()):(m.push(e.id),void(r()?this.renderBeforeRedpack(e.id):this.timeOut(e.id).startRedpack(e.id))):(void 0,void this.destory())},p.prototype.timeOut=function(e){void 0;var t=this;return t.timeBox.show(),t.timeBoxtimer=setInterval(function(){return void 0,!t.timeBox||t.timeBox.is(":hidden")?(void 0,void clearInterval(t.timeBoxtimer)):--t.maxTime<0&&t.timeBoxtimer?(t.stopRedpack(e),void clearInterval(t.timeBoxtimer)):void t.timeBox.html("00:"+(t.maxTime<10?"0"+t.maxTime:t.maxTime))},1e3),this},p.prototype.render=function(){var e=this;return this.el=$('<div id="csdn-redpack" class="csdn-redpack-container"><span class="csdn-redpack-time">00:10</span><em class="csdn-redpack-close"></em></div>'),this.timeBox=this.el.find(".csdn-redpack-time"),this.closeBtn=this.el.find(".csdn-redpack-close"),this.closeBtn.on("click",function(n){return t("redpack_close",1,864e5),e.destory(),n.stopPropagation(),!1}),$("body").append(this.el),this},p.prototype.renderBeforeRedpack=function(e){var n=this,o=$('<div class="csdn-redpack-before">\n                  <span class="csdn-redpack-enter"></span>\n                  <span class="csdn-redpack-leave"></span>\n                </div>');return o.find(".csdn-redpack-leave").on("touchstart",function(e){return t("redpack",n.currentRedPackId,n.localRedPackIdTime),n.destory().getRedPackInfo(),e.stopPropagation(),!1}),o.find(".csdn-redpack-enter").on("touchstart",function(t){if(!a())return void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));o.remove(),n.timeOut(e).startRedpack(e)}),n.el.append(o),n},p.prototype.createRedpack=function(e){var t=this,n=$('<div class="csdn-redpack"></div>'),o=r()?Math.max(1.5-Math.random(),.9):Math.max(1.7-Math.random(),1.2),i=(r(),r(),{width:56*o,height:72*o,left:Math.random()*(t.el.width()-30),top:-72*o*1.2});n.css(i),n.on("mousedown",function(n){if(!a())return void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));$(this).addClass("csdn-redpacked"),t.maxCount--,t.maxCount<=0&&t.stopRedpack(e),s({spm:"3001.6027"})}),t.el.append(n),t.moveRedpack(n),t.rains.push(n)},p.prototype.startRedpack=function(e){void 0;var t=this;return t.timer=setInterval(function(){t.createRedpack(e)},t.density),this},p.prototype.stopRedpack=function(e){return void 0,clearInterval(this.timer),clearInterval(this.timeBoxtimer),this.timeBox&&this.timeBox.remove(),this.closeBtn&&this.closeBtn.remove(),this.el&&this.el.find(".csdn-redpack").remove(),this.maxCount<1?this.luckyBoy(e):this.renderResult(),this},p.prototype.moveRedpack=function(e){var t=this,n=Math.random()+2.5,o=Math.random()-.45,i=0,a=0,d=t.el.height()||1500,r=function t(){i-=1.2*o,a+=1.2*n,e.css({transform:"translate3d("+i+"px, "+a+"px, 0)"}),a>d?e.remove():requestAnimationFrame(t)};requestAnimationFrame(r)},p.prototype.getRedPackInfo=function(){void 0,void 0;var t=this;if(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),!d())return void t.destory();void 0,$("#csdn-redpack").remove(),$(".csdn-redpack-container").remove(),$.ajax({url:t.host+"/luckydraw/api/lotteryInProgress",type:"get",data:{bizNo:"download",targetId:e(),username:n("UserName")||""},contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){if(t.dev&&(e={code:200,data:{current:null,next:{id:212,startTime:"2021/05/08 17:41:00",endTime:"2021/05/10 18:50:00"}}}),200===e.code&&e.data){var i=e.data,a=void 0;i.current&&!t.isShowedRedpack(i.current.id)?(a=i.current,void 0):i.next&&!t.isShowedRedpack(i.next.id)&&(a=i.next,void 0),a||void 0,i.current&&!n("redpack")||window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show(),o(a)&&t.currentRedPackId!==a.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),r()?t.initRedPack(a):a.autoStart?(setTimeout(function(){t.initRedPack(a)},0),s({spm:"3001.6145"}),c({spm:"3001.6145"})):t.renderLotteryBtn(a)),t.timeLine(a)}}})},p.prototype.luckyBoy=function(e){void 0;var t=this;$.ajax({url:t.host+"/luckydraw/api/timesWin",type:"post",data:JSON.stringify({lotteryId:e,username:n("UserName")}),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){t.dev&&(e={code:200,data:{prizeId:"123",name:"coupon",url:"",money:"0.01"}}),200===e.code&&e.data?t.renderResult(e.data):t.renderResult({prizeId:null})}})},p.prototype.renderResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0;var t=this,n=r();if(!d()||!a())return void t.destory();var o="csdn-redpack-sorry";e.options=e.options?JSON.parse(e.options):"",e.prizeId&&"common-coupon"===e.name?o="csdn-redpack-common-coupon":e.prizeId&&"coupon"===e.name?o="csdn-redpack-coupon":e.prizeId&&"redPacket"===e.name?o="csdn-redpack-cash":e.prizeId&&"discountCoupon"===e.name&&(o="csdn-redpack-discount");var i=$('<div class="csdn-redpack-result '+o+'">\n                   \n                    <a class="csdn-redpack-result-link" href="'+(e.url?e.url:"javascript:;")+'" '+(e.url&&!n?'target="_blank"':"")+'></a>\n                    <em class="csdn-redpack-result-close"></em>\n                    '+("csdn-redpack-cash"===o?"<span>"+e.money+"</span>":"")+"\n                    "+("csdn-redpack-sorry"!==o&&"csdn-redpack-cash"!==o?'<div class="redpack-coupon-money"><span>'+(e.options&&"discountCoupon"===e.options.type?"":'<i class="money-symbol" >¥</i>')+"<span>"+e.options.couponText.usedLimitAmount+"</span>"+(e.options&&"discountCoupon"===e.options.type?'<i class="discount-symbol">折</i>':"")+"</span><span>"+e.options.couponText.typeText+"</span></div>":"")+"\n                    "+("csdn-redpack-sorry"!==o&&"csdn-redpack-cash"!==o?'<div class="redpack-coupon-info"><span>'+e.options.couponText.text+"</span><span>"+e.options.couponText.textDesc+'</span><span class="">仅活动期间可用</span></div>':"")+"\n                </div>");this.el.append(i),void 0,i.find(".csdn-redpack-result-close").on("click",function(e){t.destory().getRedPackInfo()}),i.find(".csdn-redpack-result-link").on("click",function(e){t.destory().getRedPackInfo()})},p.prototype.timeLine=function(e){if(e){void 0;var t=this;clearInterval(t.timeLineTimer),t.timeLineTimer=setInterval(function(){if(void 0,!d())return void t.destory();o(e)&&t.currentRedPackId!==e.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),r()?t.initRedPack(e):t.renderLotteryBtn(e)),i(e)&&(t.destory(),t.getRedPackInfo())},2e4),$(document).off("visibilitychange").on("visibilitychange",function(e){void 0,document.hidden?t.destory():t.getRedPackInfo()})}},p.prototype.destory=function(){return void 0,void 0,void 0,void 0,clearInterval(this.timeLineTimer),clearInterval(this.timeBoxTimer),clearInterval(this.timer),this.el&&this.el.remove(),$(".csdn-redpack-container").remove(),$("body").find(".csdn-redpack-lottery-btn-box").remove(),this.rains=[],this.density=300,this.maxCount=1,this.maxTime=10,this.currentRedPackId=null,this.timeBox=null,this},p.prototype.isShowedRedpack=function(e){return e==n("redpack")},p.prototype.renderLotteryBtn=function(e){var o=this,i=window.location.host,d=window.location.pathname,r="",c="",p="",m="";if(this.currentRedPackId=e.id,Number(n("redpack_unlogin_click"))===e.id&&a())return void this.initRedPack(e);if(i.indexOf("blog.csdn.net")>=0?"/"===d?r=".container":2===d.split("/").length?r=$(".user-profile-body-right").length?".user-profile-body-right":".container":d.split("/").length>2&&d.indexOf("/article/details")>=0&&(r=".main_father"):r=i.indexOf("download.csdn.net")>=0?".main":i.indexOf("edu.csdn.net")>=0&&0===d.indexOf("/course/detail")?".right":i.indexOf("marketing.csdn.net")>=0?".container":i.indexOf("mall.csdn.net")>=0&&0===d.indexOf("/lottery-draw")?".home_wrap":"",r){if(c=$(r),".right"===r)p=c.width()+c.offset().left-20,m="bottom: 375px;";else if(".main_father"===r){p=-100;var u=setInterval(function(){$(".csdn-side-toolbar")&&$(".csdn-side-toolbar").offset()&&($(".csdn-redpack-lottery-btn-box").css({left:$(".csdn-side-toolbar").offset().left-20}),clearInterval(u))},500)}else p=c.width()+c.offset().left-20;var h=a()?"点我抢红包啦!":"快快快！登录CSDN抢红包啦！",f=$('<div class="csdn-redpack-lottery-btn-box" style="left: '+p+"px;"+m+'" data-report-view=\'{"spm": "3001.6025"}\'>\n        <div class="lottery-btn-box-content">\n          <img src="https://g.csdnimg.cn/common/redpack/images/lottery-monkey.gif" alt="">\n        </div>\n        <div class="lottery-btn-box-hint '+(a()?"lottery-login-hint":"lottery-unlogin-hint")+'">'+h+'</div>\n        <div class="lottery-btn-box-close"></div>\n      </div>');f.on("click",".lottery-btn-box-content",function(){a()?o.initRedPack(e):(window.csdn.loginBox.show(),t("redpack_unlogin_click",e.id,o.localRedPackIdTime)),s({spm:"3001.6025",extra:JSON.stringify({isLogin:a()})})}).on("click",".lottery-btn-box-close",function(){return $("body").find(".csdn-redpack-lottery-btn-box").remove(),t("redpack_close",1,864e5),s({spm:"3001.6026"}),!1}),$("body").append(f),l()}},window.csdn=window.csdn||{},window.csdn.redpack=new p}();