# Log4j日志漏洞方案

## 一、JAVA场景

### 1、java常用日志框架

- sl4j（log门面）
- log4j/log4j2
- logback

### 2、使用方式

`保守如果项目中没有使用到但是引用了log4j那就彻底exclusion掉或者直接删除maven先关的依赖，如果使用到了log4j那就实行升级安全版本。`

- 单独使用log4j2

  > 这种需要升级log4j版本到修复过的版本，2.14.1已上。

- 单独使用logback

  > 无需处理log升级

- sl4j+log4j2

  > 这种需要升级log4j版本到修复过的版本，2.14.1已上。

- sl4j+logback（springboot默认方式，但是如果项目依然有依赖log4j需要具体场景具体处理。）

  >  无需处理log升级

```tex
明确各自框架业务log使用的以上场景。
```

### 3、SpringBoot日志处理方式

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-logging</artifactId>
        </exclusion>
        <exclusion>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-api</artifactId>
        </exclusion>
        <exclusion>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-core</artifactId>
        </exclusion>
        <exclusion>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-jul</artifactId>
        </exclusion>
    </exclusions>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-api</artifactId>
    <version>2.15.0</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.15.0</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-jul</artifactId>
    <version>2.15.0</version>
</dependency>

```

## 二、Kafka场景

> 版本：1.x、2.x
>
> 编辑kafka安装目录下的启动脚本：`bin/kafka-server-start.sh`，找到KAFKA_LOG4J_OPTS环境变量位置，编辑变量追加jvm参数：

```properties
# 修改export的值
export KAFKA_LOG4J_OPTS="-Dlog4j.configuration=file:$base_dir/../config/log4j.properties -Dlog4j2.formatMsgNoLookups=true"
```

## 三、Redis场景



## 参考文档

[文档1](https://itsc.nju.edu.cn/7a/42/c41947a555586/page.htm)

[文档2](https://www.cnblogs.com/freeweb/p/15685658.html)

